# Virtual Machine

Polycash uses a virtual machine to run smart contracts on the blockchain. It uses a small instruction set, and code written for the architecture is stored in \*.blockasm files. The VM can store an unlimited number of registers, each of which has an unlimited size. Take care when managing memory, however- there are gas fees for every new buffer allocation. In addition, operations on larger buffers cost more gas. The price of gas is fixed to the price of PCSH, unlike many other blockchains. Most other networks use network activity data or an auction system to determine which transactions are included in blocks.

Each smart contract has a section of the unlimited, expandable state part of the global Polycash Virtual Machine. Any given smart contract has read/write access to all memory locations that begin with the contract's hash. It has read-only access to the entire VM state, with one exception: setting a buffer to a constant known as the [external state writeable value](https://github.com/Ashy5000/cryptocurrency/blob/91bd7590422ce1b489a115386975bd9619777f52/node_util/contracts.go#L38), equal to the string 'ExternalStateWriteableValue'. This enables a contract to allow other contracts to pass data to it's state, but only when it chooses so. In addition, once a contract writes to the state of another, a third contract can't also write to the same portion of state- it will be 'locked', as the state is now set to a different value than the external state writeable value. Therefore, a contract must wait to write to another's state until the target contract sets the state back to the external state writeable value. This system is known as the external state system. Take care not to set an address in your contract's state to the external state writeable value unless you want another contract to be able to write to it!
